(window.webpackJsonp=window.webpackJsonp||[]).push([[405],{870:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"tomcat---源码分析准备和分析入口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tomcat---源码分析准备和分析入口"}},[s._v("¶")]),s._v(" Tomcat - 源码分析准备和分析入口")]),s._v(" "),a("blockquote",[a("p",[s._v("上文我们介绍了Tomcat的架构设计，接下来我们便可以下载源码以及寻找源码入口了。@pdai")])]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#tomcat---%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%87%86%E5%A4%87%E5%92%8C%E5%88%86%E6%9E%90%E5%85%A5%E5%8F%A3"}},[s._v("Tomcat - 源码分析准备和分析入口")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%92%8C%E7%BC%96%E8%AF%91"}},[s._v("源代码下载和编译")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%8B%E8%BD%BD%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E5%92%8C%E6%BA%90%E7%A0%81"}},[s._v("下载二进制包和源码")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81"}},[s._v("编译源码")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E7%90%86%E8%A7%A3%E7%BC%96%E8%AF%91%E5%90%8E%E6%A8%A1%E5%9D%97"}},[s._v("理解编译后模块")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BB%8E%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E5%AE%9A%E4%BD%8Dtomcat%E6%BA%90%E7%A0%81%E5%85%A5%E5%8F%A3"}},[s._v("从启动脚本定位Tomcat源码入口")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#startupbat"}},[s._v("startup.bat")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#catalinabat"}},[s._v("catalina.bat")])])])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"}},[s._v("参考文章")])])])])]),s._v(" "),a("h2",{attrs:{id:"源代码下载和编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源代码下载和编译"}},[s._v("¶")]),s._v(" 源代码下载和编译")]),s._v(" "),a("p",[s._v("首先是去官网下载Tomcat的源代码和二进制安装包，我这里分析最新的"),a("a",{attrs:{href:"https://tomcat.apache.org/download-90.cgi",target:"_blank",rel:"noopener noreferrer"}},[s._v("Tomcat9.0.39稳定版本"),a("OutboundLink")],1),s._v("https://tomcat.apache.org/download-90.cgi")]),s._v(" "),a("h3",{attrs:{id:"下载二进制包和源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载二进制包和源码"}},[s._v("¶")]),s._v(" 下载二进制包和源码")]),s._v(" "),a("blockquote",[a("p",[s._v("下载二进制包的主要目的在于，让我们回顾一下包中的内容；其次，在我们后面通过源码包编译后，以方便和二进制包进行对比。")])]),s._v(" "),a("ul",[a("li",[s._v("下载两个包")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-2.png",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("查看二进制包中主要模块")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-3.png",loading:"lazy"}})]),s._v(" "),a("h3",{attrs:{id:"编译源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译源码"}},[s._v("¶")]),s._v(" 编译源码")]),s._v(" "),a("ul",[a("li",[s._v("导入IDEA")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-4.png",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("使用ant编译")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-1.png",loading:"lazy"}})]),s._v(" "),a("h3",{attrs:{id:"理解编译后模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解编译后模块"}},[s._v("¶")]),s._v(" 理解编译后模块")]),s._v(" "),a("blockquote",[a("p",[s._v("这里有两点要注意下：第一：在编译完之后，编译输出到哪里了呢？第二：编译后的结果是不是和我们下载的二进制文件对的上呢？")])]),s._v(" "),a("ul",[a("li",[s._v("编译的输出在哪里")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-5.png",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("编译的输出结果是否对的上，很显然和上面的二进制包一致")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://pdai-1257820000.cos.ap-beijing.myqcloud.com/pdai.tech/public/_images/tomcat/tomcat-x-sourcecode-6.png",loading:"lazy"}})]),s._v(" "),a("h2",{attrs:{id:"从启动脚本定位tomcat源码入口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从启动脚本定位tomcat源码入口"}},[s._v("¶")]),s._v(" 从启动脚本定位Tomcat源码入口")]),s._v(" "),a("blockquote",[a("p",[s._v("好了，到这里我们基本上已经有准备好代码了，接下来便是寻找代码入口了。@pdai")])]),s._v(" "),a("h3",{attrs:{id:"startupbat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#startupbat"}},[s._v("¶")]),s._v(" startup.bat")]),s._v(" "),a("blockquote",[a("p",[s._v("当我们初学tomcat的时候, 肯定先要学习怎样启动tomcat. 在tomcat的bin目录下有两个启动tomcat的文件, 一个是startup.bat, 它用于windows环境下启动tomcat; 另一个是startup.sh, 它用于linux环境下tomcat的启动. 两个文件中的逻辑是一样的, 我们只分析其中的startup.bat.")])]),s._v(" "),a("ul",[a("li",[s._v("startup.bat的源码: "),a("strong",[s._v("startup.bat文件实际上就做了一件事情: 启动catalina.bat.")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("@echo off\nrem Licensed to the Apache Software Foundation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ASF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" under one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v("\nrem contributor license agreements.  See the NOTICE "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" distributed with\nrem this work "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" additional information regarding copyright ownership.\nrem The ASF licenses this "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to You under the Apache License, Version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("\nrem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"License"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" you may not use this "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" except "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" compliance with\nrem the License.  You may obtain a copy of the License at\nrem\nrem     http://www.apache.org/licenses/LICENSE-2.0\nrem\nrem Unless required by applicable law or agreed to "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" writing, software\nrem distributed under the License is distributed on an "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AS IS"')]),s._v(" BASIS,\nrem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nrem See the License "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the specific language governing permissions and\nrem limitations under the License.\n\nrem ---------------------------------------------------------------------------\nrem Start script "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the CATALINA Server\nrem ---------------------------------------------------------------------------\n\nsetlocal\n\nrem Guess CATALINA_HOME "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not defined\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CURRENT_DIR=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%CURRENT_DIR%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CURRENT_DIR%"')]),s._v("\n:gotHome\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" The CATALINA_HOME environment variable is not defined correctly\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" This environment variable is needed to run this program\ngoto end\n:okHome\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EXECUTABLE=%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v("\n\nrem Check that target executable exists\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%EXECUTABLE%"')]),s._v(" goto okExec\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Cannot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%EXECUTABLE%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" This "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" is needed to run this program\ngoto end\n:okExec\n\nrem Get remaining unshifted "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line arguments and save them "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CMD_LINE_ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n:setArgs\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"'),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" goto doneSetArgs\nset CMD_LINE_ARGS=%CMD_LINE_ARGS% %1\nshift\ngoto setArgs\n:doneSetArgs\n\ncall "')]),s._v('%EXECUTABLE%" start %CMD_LINE_ARGS%\n\n:end\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("ul",[a("li",[s._v("当然如果你感兴趣，不妨也可以看下上面脚本的含义\n"),a("ul",[a("li",[s._v(".bat文件中@echo是打印指令, 用于控制台输出信息, rem是注释符.")]),s._v(" "),a("li",[s._v("跳过开头的注释, 我们来到配置CATALINA_HOME的代码段, 执行startup.bat文件首先会设置CATALINA_HOME.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CURRENT_DIR=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%CURRENT_DIR%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CURRENT_DIR%"')]),s._v("\n:gotHome\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" The CATALINA_HOME environment variable is not defined correctly\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" This environment variable is needed to run this program\ngoto end\n:okHome\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("先通过set指令把当前目录设置到一个名为CURRENT_DIR的变量中,")]),s._v(" "),a("li",[s._v("如果系统中配置过CATALINA_HOME则跳到gotHome代码段. 正常情况下我们的电脑都没有配置CATALINA_HOME, 所以往下执行, 把当前目录设置为CATALINA_HOME.")]),s._v(" "),a("li",[s._v("然后判断CATALINA_HOME目录下是否存在catalina.bat文件, 如果存在就跳到okHome代码块.")]),s._v(" "),a("li",[s._v("在okHome中, 会把catalina.bat文件的的路径赋给一个叫EXECUTABLE的变量, 然后会进一步判断这个路径是否存在, 存在则跳转到okExec代码块, 不存在的话会在控制台输出一些错误信息.")]),s._v(" "),a("li",[s._v("在okExec中, 会把setArgs代码块的返回结果赋值给CMD_LINE_ARGS变量, 这个变量用于存储启动参数.")]),s._v(" "),a("li",[s._v('setArgs中首先会判断是否有参数, (if ""%1""==""""判断第一个参数是否为空), 如果没有参数则相当于参数项为空. 如果有参数则循环遍历所有的参数(每次拼接第一个参数).')]),s._v(" "),a("li",[s._v('最后执行call "%EXECUTABLE%" start %CMD_LINE_ARGS%, 也就是说执行catalina.bat文件, 如果有参数则带上参数.')])])])]),s._v(" "),a("blockquote",[a("p",[s._v("这样看来, 在windows下启动tomcat未必一定要通过startup.bat, 用catalina.bat start也是可以的.")])]),s._v(" "),a("h3",{attrs:{id:"catalinabat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#catalinabat"}},[s._v("¶")]),s._v(" catalina.bat")]),s._v(" "),a("blockquote",[a("p",[s._v("catalina的脚本有点多，我们分开看：")])]),s._v(" "),a("ul",[a("li",[s._v("跳过开头的注释, 我们来到下面的代码段:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setlocal\n\nrem Suppress Terminate batch job on CTRL+C\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("run"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto mainEntry\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto mainEntry\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.run"')]),s._v(" goto mainEntry\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Y"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.run"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.run"')]),s._v(" goto mainEntry\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Y"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.Y"')]),s._v("\ncall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%~f0"')]),s._v(" %* "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.Y"')]),s._v("\nrem Use provided errorlevel\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%ERRORLEVEL%\ndel /Q "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.Y"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("NUL "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" /B %RETVAL%\n:mainEntry\ndel /Q "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TEMP%\\%~nx0.run"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("NUL "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("大多情况下我们启动tomcat都没有设置参数, 所以直接跳到mainEntry代码段, 删除了一个临时文件后, 继续往下执行.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rem Guess CATALINA_HOME "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not defined\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CURRENT_DIR=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%CURRENT_DIR%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_HOME=%cd%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CURRENT_DIR%"')]),s._v("\n:gotHome\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.bat"')]),s._v(" goto okHome\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" The CATALINA_HOME environment variable is not defined correctly\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" This environment variable is needed to run this program\ngoto end\n:okHome\n\nrem Copy CATALINA_BASE from CATALINA_HOME "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not defined\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotBase\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CATALINA_BASE=%CATALINA_HOME%"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ul",[a("li",[s._v("可以看到这段代码与startup.bat中开头的代码相似, 在确定CATALINA_HOME下有catalina.bat后把CATALINA_HOME赋给变量CATALINA_BASE.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rem Get standard environment variables\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setenv.bat"')]),s._v(" goto checkSetenvHome\ncall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setenv.bat"')]),s._v("\ngoto setenvDone\n:checkSetenvHome\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setenv.bat"')]),s._v(" call "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setenv.bat"')]),s._v("\n:setenvDone\n\nrem Get standard Java environment variables\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exist "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setclasspath.bat"')]),s._v(" goto okSetclasspath\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Cannot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setclasspath.bat"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" This "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" is needed to run this program\ngoto end\n:okSetclasspath\ncall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('in\\setclasspath.bat"')]),s._v(" %1\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" errorlevel "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" goto end\n\nrem Add on extra jar "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to CLASSPATH\nrem Note that there are no quotes as we "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not want to introduce random\nrem quotes into the CLASSPATH\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto emptyClasspath\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CLASSPATH=%CLASSPATH%;"')]),s._v("\n:emptyClasspath\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CLASSPATH=%CLASSPATH%%CATALINA_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v("in"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[s._v("\\b")]),s._v('ootstrap.jar"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("blockquote",[a("p",[s._v("上面这段代码依次执行了setenv.bat和setclasspath.bat文件, 目的是获得CLASSPATH, 相信会Java的同学应该都会在配置环境变量时都配置过classpath, 系统拿到classpath路径后把它和CATALINA_HOME拼接在一起, 最终定位到一个叫bootstrap.jar的文件. 虽然后面还有很多代码, 但是这里必须暂停提示一下: bootstrap.jar将是我们启动tomcat的环境.")])]),s._v(" "),a("ul",[a("li",[s._v("接下来从gotTmpdir代码块到noEndorsedVar代码块进行了一些配置, 由于不是主要内容暂且跳过.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using CATALINA_BASE:   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using CATALINA_HOME:   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using CATALINA_TMPDIR: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto use_jdk\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using JRE_HOME:        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JRE_HOME%"')]),s._v("\ngoto java_dir_displayed\n:use_jdk\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using JAVA_HOME:       "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_HOME%"')]),s._v("\n:java_dir_displayed\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using CLASSPATH:       "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_EXECJAVA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%_RUNJAVA%\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAINCLASS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.apache.catalina.startup.Bootstrap\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ACTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("start\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SECURITY_POLICY_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEBUG_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("jpda"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto noJpda\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jpda\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_TRANSPORT%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaTransport\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_TRANSPORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dt_socket\n:gotJpdaTransport\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_ADDRESS%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaAddress\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n:gotJpdaAddress\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_SUSPEND%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaSuspend\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_SUSPEND")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n\n:gotJpdaSuspend\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_OPTS%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaOpts\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-agentlib:jdwp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("transport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_TRANSPORT%,address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_ADDRESS%,server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y,suspend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_SUSPEND%\n:gotJpdaOpts\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("shift")]),s._v("\n:noJpda\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doDebug\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("run"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doRun\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("start"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doStart\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doStop\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("configtest"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doConfigTest\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("version"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doVersion\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("ul",[a("li",[s._v("接下来, 我们能看到一些重要的信息, 其中的重点是:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_EXECJAVA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%_RUNJAVA%, 设置了jdk中bin目录下的java.exe文件路径.\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAINCLASS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.apache.catalina.startup.Bootstrap, 设置了tomcat的启动类为Bootstrap这个类. "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("后面会分析这个类"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ACTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("start设置tomcat启动\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("大家可以留意这些参数, 最后执行tomcat的启动时会用到.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("jpda"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto noJpda\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jpda\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_TRANSPORT%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaTransport\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_TRANSPORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dt_socket\n:gotJpdaTransport\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_ADDRESS%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaAddress\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_ADDRESS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n:gotJpdaAddress\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_SUSPEND%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaSuspend\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_SUSPEND")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n\n:gotJpdaSuspend\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA_OPTS%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto gotJpdaOpts\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JPDA_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-agentlib:jdwp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("transport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_TRANSPORT%,address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_ADDRESS%,server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y,suspend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%JPDA_SUSPEND%\n:gotJpdaOpts\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("shift")]),s._v("\n:noJpda\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doDebug\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("run"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doRun\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("start"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doStart\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doStop\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("configtest"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doConfigTest\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("version"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doVersion\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("ul",[a("li",[s._v("接着判断第一个参数是否是jpda, 是则进行一些设定. 而正常情况下第一个参数是start, 所以跳过这段代码. 接着会判断第一个参数的内容, 根据判断, 我们会跳到doStart代码段. (有余力的同学不妨看下debug, run等启动方式)")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(":doStart\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("shift")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TITLE%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TITLE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Tomcat\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_EXECJAVA")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("start "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%TITLE%"')]),s._v(" %_RUNJAVA%\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("-security"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto execCmd\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("shift")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Using Security Manager\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SECURITY_POLICY_FILE=%CATALINA_BASE%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v("onf"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('atalina.policy"')]),s._v("\ngoto execCmd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("可以看到doStart中无非也是设定一些参数, 最终会跳转到execCmd代码段")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(":execCmd\nrem Get remaining unshifted "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line arguments and save them "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CMD_LINE_ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n:setArgs\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("%1"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"" goto doneSetArgs\n'),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CMD_LINE_ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%CMD_LINE_ARGS% %1\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("shift")]),s._v("\ngoto setArgs\n:doneSetArgs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("可以看到这段代码也是在拼接参数, 把参数拼接到一个叫CMD_LINE_ARGS的变量中, 接下来就是catalina最后的一段代码了.")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rem Execute Java with the applicable properties\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JPDA%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doJpda\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%SECURITY_POLICY_FILE%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doSecurity\n%_EXECJAVA% %LOGGING_CONFIG% %LOGGING_MANAGER% %JAVA_OPTS% %CATALINA_OPTS% %DEBUG_OPTS% -D%ENDORSED_PROP%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_ENDORSED_DIRS%"')]),s._v(" -classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" -Dcatalina.base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" -Dcatalina.home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" -Djava.io.tmpdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v(" %MAINCLASS% %CMD_LINE_ARGS% %ACTION%\ngoto end\n:doSecurity\n%_EXECJAVA% %LOGGING_CONFIG% %LOGGING_MANAGER% %JAVA_OPTS% %CATALINA_OPTS% %DEBUG_OPTS% -D%ENDORSED_PROP%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_ENDORSED_DIRS%"')]),s._v(" -classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" -Djava.security.manager -Djava.security.policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%SECURITY_POLICY_FILE%"')]),s._v(" -Dcatalina.base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" -Dcatalina.home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" -Djava.io.tmpdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v(" %MAINCLASS% %CMD_LINE_ARGS% %ACTION%\ngoto end\n:doJpda\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" not "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%SECURITY_POLICY_FILE%"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" goto doSecurityJpda\n%_EXECJAVA% %LOGGING_CONFIG% %LOGGING_MANAGER% %JAVA_OPTS% %JPDA_OPTS% %CATALINA_OPTS% %DEBUG_OPTS% -D%ENDORSED_PROP%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_ENDORSED_DIRS%"')]),s._v(" -classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" -Dcatalina.base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" -Dcatalina.home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" -Djava.io.tmpdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v(" %MAINCLASS% %CMD_LINE_ARGS% %ACTION%\ngoto end\n:doSecurityJpda\n%_EXECJAVA% %LOGGING_CONFIG% %LOGGING_MANAGER% %JAVA_OPTS% %JPDA_OPTS% %CATALINA_OPTS% %DEBUG_OPTS% -D%ENDORSED_PROP%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_ENDORSED_DIRS%"')]),s._v(" -classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" -Djava.security.manager -Djava.security.policy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%SECURITY_POLICY_FILE%"')]),s._v(" -Dcatalina.base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" -Dcatalina.home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" -Djava.io.tmpdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v(" %MAINCLASS% %CMD_LINE_ARGS% %ACTION%\ngoto end\n\n:end\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("ul",[a("li",[s._v("跳过前面两行判断后, 来到了关键语句:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("%_EXECJAVA% %LOGGING_CONFIG% %LOGGING_MANAGER% %JAVA_OPTS% %CATALINA_OPTS% %DEBUG_OPTS% -D%ENDORSED_PROP%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%JAVA_ENDORSED_DIRS%"')]),s._v(" -classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CLASSPATH%"')]),s._v(" -Dcatalina.base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_BASE%"')]),s._v(" -Dcatalina.home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_HOME%"')]),s._v(" -Djava.io.tmpdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%CATALINA_TMPDIR%"')]),s._v(" %MAINCLASS% %CMD_LINE_ARGS% %ACTION%\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v('_EXECJAVA也就是_RUNJAVA, 也就是平时说的java指令, 但在之前的doStart代码块中把_EXECJAVA改为了start "%TITLE%" %_RUNJAVA%, 所以系统会另启一个命令行窗口, 名字叫Tomcat.\n在拼接一系列参数后, 我们会看见%MAINCLASS%, 也就是org.apache.catalina.startup.Bootstrap启动类, 拼接完启动参数后, 最后拼接的是%ACTION%, 也就是start.')])]),s._v(" "),a("p",[a("strong",[s._v("总结")]),s._v(":")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("catalina.bat最终执行了Bootstrap类中的main方法")]),s._v(".")]),s._v(" "),a("li",[s._v("我们可以通过设定不同的参数让tomcat以不同的方式运行. 在ide中我们是可以选择debug等模式启动tomcat的, 也可以为其配置参数, 在catalina.bat中我们看到了启动tomcat背后的运作流程.")])]),s._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("¶")]),s._v(" 参考文章")]),s._v(" "),a("ul",[a("li",[s._v("https://www.cnblogs.com/tanshaoshenghao/p/10932306.html")])])])}),[],!1,null,null,null);t.default=e.exports}}]);