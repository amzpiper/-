(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{687:function(e,s,a){"use strict";a.r(s);var t=a(11),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"sql语言---sql语句优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql语言---sql语句优化"}},[e._v("¶")]),e._v(" SQL语言 - SQL语句优化")]),e._v(" "),a("blockquote",[a("p",[e._v("最后，再总结一些SQL语句的优化建议。@pdai")])]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#sql%e8%af%ad%e8%a8%80---sql%e8%af%ad%e5%8f%a5%e4%bc%98%e5%8c%96"}},[e._v("SQL语言 - SQL语句优化")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%e8%b4%9f%e5%90%91%e6%9f%a5%e8%af%a2%e4%b8%8d%e8%83%bd%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95"}},[e._v("负向查询不能使用索引")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%89%8d%e5%af%bc%e6%a8%a1%e7%b3%8a%e6%9f%a5%e8%af%a2%e4%b8%8d%e8%83%bd%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95"}},[e._v("前导模糊查询不能使用索引")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e6%95%b0%e6%8d%ae%e5%8c%ba%e5%88%86%e4%b8%8d%e6%98%8e%e6%98%be%e7%9a%84%e4%b8%8d%e5%bb%ba%e8%ae%ae%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95"}},[e._v("数据区分不明显的不建议创建索引")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%ad%97%e6%ae%b5%e7%9a%84%e9%bb%98%e8%ae%a4%e5%80%bc%e4%b8%8d%e8%a6%81%e4%b8%ba-null"}},[e._v("字段的默认值不要为 null")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%9c%a8%e5%ad%97%e6%ae%b5%e4%b8%8a%e8%bf%9b%e8%a1%8c%e8%ae%a1%e7%ae%97%e4%b8%8d%e8%83%bd%e5%91%bd%e4%b8%ad%e7%b4%a2%e5%bc%95"}},[e._v("在字段上进行计算不能命中索引")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e6%9c%80%e5%b7%a6%e5%89%8d%e7%bc%80%e9%97%ae%e9%a2%98"}},[e._v("最左前缀问题")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%a6%82%e6%9e%9c%e6%98%8e%e7%a1%ae%e7%9f%a5%e9%81%93%e5%8f%aa%e6%9c%89%e4%b8%80%e6%9d%a1%e8%ae%b0%e5%bd%95%e8%bf%94%e5%9b%9e"}},[e._v("如果明确知道只有一条记录返回")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e4%b8%8d%e8%a6%81%e8%ae%a9%e6%95%b0%e6%8d%ae%e5%ba%93%e5%b8%ae%e6%88%91%e4%bb%ac%e5%81%9a%e5%bc%ba%e5%88%b6%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2"}},[e._v("不要让数据库帮我们做强制类型转换")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%a6%82%e6%9e%9c%e9%9c%80%e8%a6%81%e8%bf%9b%e8%a1%8c-join-%e7%9a%84%e5%ad%97%e6%ae%b5%e4%b8%a4%e8%a1%a8%e7%9a%84%e5%ad%97%e6%ae%b5%e7%b1%bb%e5%9e%8b%e8%a6%81%e7%9b%b8%e5%90%8c"}},[e._v("如果需要进行 join 的字段两表的字段类型要相同")])])])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%e5%8f%82%e8%80%83"}},[e._v("参考")])])]),e._v(" "),a("h2",{attrs:{id:"负向查询不能使用索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负向查询不能使用索引"}},[e._v("¶")]),e._v(" 负向查询不能使用索引")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("not")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("in")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("应该修改为:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("select name from user where id in (2,5,6);\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"前导模糊查询不能使用索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前导模糊查询不能使用索引"}},[e._v("¶")]),e._v(" 前导模糊查询不能使用索引")]),e._v(" "),a("p",[e._v("如:")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("like")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'%zhangsan'")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("非前导则可以:")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("like")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zhangsan%'")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("建议可以考虑使用 "),a("code",[e._v("Lucene")]),e._v(" 等全文索引工具来代替频繁的模糊查询。")]),e._v(" "),a("h2",{attrs:{id:"数据区分不明显的不建议创建索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据区分不明显的不建议创建索引"}},[e._v("¶")]),e._v(" 数据区分不明显的不建议创建索引")]),e._v(" "),a("p",[e._v("如 user 表中的性别字段，可以明显区分的才建议创建索引，如身份证等字段。")]),e._v(" "),a("h2",{attrs:{id:"字段的默认值不要为-null"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段的默认值不要为-null"}},[e._v("¶")]),e._v(" 字段的默认值不要为 null")]),e._v(" "),a("p",[e._v("这样会带来和预期不一致的查询结果。")]),e._v(" "),a("h2",{attrs:{id:"在字段上进行计算不能命中索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在字段上进行计算不能命中索引"}},[e._v("¶")]),e._v(" 在字段上进行计算不能命中索引")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" FROM_UNIXTIME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" CURDATE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("应该修改为:")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" create_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" FROM_UNIXTIME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("CURDATE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"最左前缀问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最左前缀问题"}},[e._v("¶")]),e._v(" 最左前缀问题")]),e._v(" "),a("p",[e._v("如果给 user 表中的 username pwd 字段创建了复合索引那么使用以下SQL 都是可以命中索引:")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" username "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zhangsan'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("and")]),e._v(" pwd "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'axsedf1sd'")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" username "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" pwd "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'axsedf1sd'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("and")]),e._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zhangsan'")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" username "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zhangsan'")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("但是使用")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" username "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" pwd "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'axsedf1sd'")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("是不能命中索引的。")]),e._v(" "),a("h2",{attrs:{id:"如果明确知道只有一条记录返回"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果明确知道只有一条记录返回"}},[e._v("¶")]),e._v(" 如果明确知道只有一条记录返回")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'zhangsan'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("limit")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("可以提高效率，可以让数据库停止游标移动。")]),e._v(" "),a("h2",{attrs:{id:"不要让数据库帮我们做强制类型转换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不要让数据库帮我们做强制类型转换"}},[e._v("¶")]),e._v(" 不要让数据库帮我们做强制类型转换")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("user")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" telno"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("18722222222")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("这样虽然可以查出数据，但是会导致全表扫描。")]),e._v(" "),a("p",[e._v("需要修改为")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("select name from user where telno='18722222222'\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"如果需要进行-join-的字段两表的字段类型要相同"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果需要进行-join-的字段两表的字段类型要相同"}},[e._v("¶")]),e._v(" 如果需要进行 join 的字段两表的字段类型要相同")]),e._v(" "),a("p",[e._v("不然也不会命中索引。")]),e._v(" "),a("h1",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("¶")]),e._v(" 参考")]),e._v(" "),a("ul",[a("li",[e._v("https://github.com/realpdai/JCSprout/blob/master/MD/SQL-optimization.md")]),e._v(" "),a("li",[e._v("http://blog.csdn.net/u010003835/article/details/54381080")]),e._v(" "),a("li",[a("ul",[a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/BMQC2oJlhLoeBDtveXgHpw",target:"_blank",rel:"noopener noreferrer"}},[e._v("MySQL 大表优化方案"),a("OutboundLink")],1)])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);